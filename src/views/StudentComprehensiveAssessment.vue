<!--
 * @Author: STATICHIT 2394412110@qq.com
 * @Date: 2023-11-06 22:50:19
 * @LastEditors: STATICHIT 2394412110@qq.com
 * @LastEditTime: 2024-01-22 22:15:19
 * @FilePath: \collegeApplication\src\views\StudentComprehensiveAssessment.vue
 * @Description: å­¦ç”Ÿä¸ªäººç»¼æµ‹æŸ¥çœ‹é¡µé¢
-->
<template>
  <div class="show-container">
    <div class="title">
      <div class="text">ä¸ªäººç»¼æµ‹æŸ¥çœ‹</div>
    </div>
    <hr />
    <br />
    <div>
      <el-form-item label="æœ¬æœˆç¡®è®¤æƒ…å†µ ï¼š">
        {{ data.state }}
        <span style="color: rgb(167, 167, 167); margin-left: 15px">
          (å·²ç¡®è®¤/å¾…ç¡®è®¤/æœªåˆ°ç¡®è®¤æ—¶é—´)</span
        >
      </el-form-item>
      <el-button type="primary" @click="data.dialogVisible3 = true"
        >ç”³è¯‰å†å²</el-button
      >
      <el-button type="danger" @click="data.dialogVisible2 = true"
        >ç”³æŠ¥é”™è¯¯</el-button
      >
    </div>
    <br />
    <div>
      <div>
        <h4>æœ¬æœˆç»¼æµ‹æƒ…å†µç¡®è®¤</h4>
        <br />
        <el-table :data="data.assessment" style="width: 100%">
          <el-table-column prop="id" label="å­¦å·" width="120" />
          <el-table-column prop="name" label="å§“å" width="150" />
          <el-table-column label="å¾·è‚²">
            <el-table-column prop="add1" label="åŠ åˆ†æ˜ç»†" width="120" />
            <el-table-column prop="sub1" label="å‡åˆ†æ˜ç»†" width="120" />
            <el-table-column prop="point1" label="å¾—åˆ†" width="60" />
          </el-table-column>
          <el-table-column label="æ™ºè‚²">
            <el-table-column prop="add2" label="åŠ åˆ†æ˜ç»†" width="120" />
            <el-table-column prop="sub2" label="å‡åˆ†æ˜ç»†" width="120" />
            <el-table-column prop="point2" label="å¾—åˆ†" width="60" />
          </el-table-column>
          <el-table-column label="ä½“è‚²">
            <el-table-column prop="add3" label="åŠ åˆ†æ˜ç»†" width="120" />
            <el-table-column prop="sub3" label="å‡åˆ†æ˜ç»†" width="120" />
            <el-table-column prop="point3" label="å¾—åˆ†" width="60" />
          </el-table-column>
          <el-table-column label="ç¾è‚²">
            <el-table-column prop="add4" label="åŠ åˆ†æ˜ç»†" width="120" />
            <el-table-column prop="sub4" label="å‡åˆ†æ˜ç»†" width="120" />
            <el-table-column prop="point4" label="å¾—åˆ†" width="60" />
          </el-table-column>
          <el-table-column label="åŠ³åŠ¨">
            <el-table-column prop="add5" label="åŠ åˆ†æ˜ç»†" width="120" />
            <el-table-column prop="sub5" label="å‡åˆ†æ˜ç»†" width="120" />
            <el-table-column prop="point5" label="å¾—åˆ†" width="60" />
          </el-table-column>
          <el-table-column label="å½“æœˆç»¼åˆæµ‹è¯„å¾—åˆ†" fixed="right">
            <el-table-column prop="add_total" label="æœˆåŠ åˆ†" width="70" />
            <el-table-column prop="sub_total" label="æœˆå‡åˆ†" width="70" />
            <el-table-column prop="pre_total" label="ä¸Šæœˆå¾—åˆ†" width="85" />
            <el-table-column prop="point_total" label="å½“æœˆæ€»åˆ†" width="85" />
          </el-table-column>
        </el-table>
        <br />
      </div>
      <el-button type="primary" @click="data.dialogVisible = true"
        >å‰å¾€ç”µå­ç­¾å</el-button
      >
      <br />
      <span style="color: rgb(167, 167, 167)"
        >âŠ™ç»¼åˆç´ è´¨æµ‹è¯„æˆç»© = å¾·è‚² x 20% + æ™ºè‚² x 20% + ä½“è‚² x 20% + ç¾è‚²ã€€x 20%
        +åŠ³åŠ¨ x 20%</span
      >
      <br /><br />
      <div>
        <h4>æœ¬å­¦æœŸæ€»ä½“ç»¼æµ‹æƒ…å†µ</h4>
        <br />
        <el-table :data="data.assessment">
          <el-table-column prop="id" label="å­¦å·" />
          <el-table-column prop="name" label="å§“å" />
          <el-table-column prop="point1" label="å¾·è‚²å¾—åˆ†" />
          <el-table-column prop="point2" label="æ™ºè‚²å¾—åˆ†" />
          <el-table-column prop="point3" label="ä½“è‚²å¾—åˆ†" />
          <el-table-column prop="point4" label="ç¾è‚²å¾—åˆ†" />
          <el-table-column prop="point5" label="åŠ³åŠ¨å¾—åˆ†" />
          <el-table-column label="ç»¼åˆæµ‹è¯„å¾—åˆ†" fixed="right">
            <el-table-column prop="add_total" label="åŠ åˆ†" />
            <el-table-column prop="sub_total" label="å‡åˆ†" />
            <el-table-column prop="point_total" label="ç»¼æµ‹æ€»åˆ†" />
          </el-table-column>
        </el-table>
        <br />
      </div>
    </div>
  </div>
  <!-- ç”µå­ç­¾åå¯¹è¯æ¡† -->
  <el-dialog v-model="data.dialogVisible" title="ç”µå­ç­¾å" width="50%">
    <div>
      <div style="margin-left: 1rem; margin-bottom: 1rem">
        è¯¥ç”µå­ç­¾åä¸ºç¡®ä¿ç»¼æµ‹ä¿¡æ¯ç»è¿‡æœ¬äººç¡®è®¤åæ— è¯¯
      </div>
      <signatures></signatures>
    </div>
  </el-dialog>
  <!-- ç”³æŠ¥é”™è¯¯å¯¹è¯æ¡† -->
  <el-dialog v-model="data.dialogVisible2" title="ç”³æŠ¥é”™è¯¯" width="30%">
    <div>
      <el-form-item label="ç”³è¯‰é—®é¢˜ç±»å‹ï¼š">
        <el-select
          v-model="data.target"
          class="m-2"
          placeholder="è¯·é€‰æ‹©ç”³æŠ¥é—®é¢˜ç±»å‹"
        >
          <el-option
            v-for="item in data.targets"
            :key="item.value"
            :label="item.label"
            :value="item.value"
          />
        </el-select>
      </el-form-item>
      <el-form-item label="é”™è¯¯ç”³æŠ¥å†…å®¹ï¼š">
        <el-input
          v-model="data.textarea"
          :autosize="{ minRows: 6, maxRows: 10 }"
          type="textarea"
          placeholder="è¯·è¾“å…¥é”™è¯¯ç”³æŠ¥å†…å®¹"
        />
      </el-form-item>
    </div>
    <template #footer>
      <span class="dialog-footer">
        <el-button type="primary" @click="commit"> æäº¤ç”³æŠ¥ </el-button>
      </span>
    </template>
  </el-dialog>
  <!-- ç”³è¯‰å†å²å¯¹è¯æ¡† -->
  <el-dialog v-model="data.dialogVisible3" title="ğŸ’¬ å¾…ç”³è¿°å¤„ç†" width="50%">
    <div>
      <el-table :data="data.complaintData" style="width: 100%">
        <el-table-column type="index" />
        <el-table-column label="ç”³è¯‰é—®é¢˜ç±»å‹" prop="type" min-width="120" />
        <el-table-column label="ç”³è¯‰å†…å®¹" prop="content" min-width="300" />
        <el-table-column label="ç”³è¯‰æ—¶é—´" prop="created" min-width="200" />
        <el-table-column label="ç”³è¯‰çŠ¶æ€" min-width="100">
          <template #default="scope">
            <span v-if="scope.row.state == 0">å¤„ç†ä¸­</span>
            <span v-if="scope.row.state == 1">å·²å¤„ç†</span>
            <span v-if="scope.row.state == 2">å·²æ’¤é”€</span>
          </template>
        </el-table-column>
        <el-table-column
          label="ç”³è¯‰çŠ¶æ€"
          width="100"
          :filters="[
            { text: 'å¤„ç†ä¸­', value: '0' },
            { text: 'å·²å¤„ç†', value: '1' },
            { text: 'å·²æ’¤é”€', value: '2' },
          ]"
          :filter-method="filterTag"
          filter-placement="bottom-end"
        >
          <template #default="scope">
            <el-tag
              :type="scope.row.state === 1 ? '' : 'success'"
              disable-transitions
            >
              <span v-if="scope.row.state == 0">å¤„ç†ä¸­</span>
              <span v-if="scope.row.state == 1">å·²å¤„ç†</span>
              <span v-if="scope.row.state == 2">å·²æ’¤é”€</span>
            </el-tag
            >
          </template>
        </el-table-column>
        <el-table-column label="æ“ä½œ" min-width="150">
          <template #default="scope">
            <el-button
              size="small"
              type="danger"
              @click="handleDelete(scope.$index, scope.row)"
              >åˆ é™¤</el-button
            >
          </template>
        </el-table-column>
      </el-table>
    </div>
  </el-dialog>
</template>
<script setup>
import signatures from "@/components/utils/Signatures.vue";
import { ref, reactive, computed, onMounted } from "vue";
import { ElMessageBox, ElMessage } from "element-plus";
import studentFun from "@/api/student";
import { adaptiveColumnWidthFun } from "@/assets/js/utils/adaptive-column-width";
const data = reactive({
  state: "æœªåˆ°ç¡®è®¤æ—¶é—´",
  assessment: [
    {
      id: "2021401449",
      name: "ä»˜å°å°",
      add1: "å¸®åŠ©è€å¸ˆæ‰¹æ”¹ä½œä¸š2åˆ†",
      sub1: "æ—·è¯¾1åˆ†",
      point1: 1,
      add2: "ç»©ç‚¹8åˆ†",
      sub2: "æŒ‚ç§‘1é—¨2åˆ†",
      point2: 6,
      add3: "é“…çƒæ¯”èµ›ä¸€ç­‰å¥–5åˆ†1kmäºŒç­‰å¥–4åˆ†",
      sub3: "æ— ",
      point3: 9,
      add4: "æçŒ®ä¹¦æ³•ç”»1åˆ†",
      sub4: "ç ´ç¯è‰åª1åˆ†",
      point4: 0,
      add5: "å€¼æ—¥2æ¬¡4åˆ†",
      sub5: "æ— ",
      point5: 4,
      add_total: 24,
      sub_total: 4,
      pre_total: 18,
      point_total: 20,
    },
  ],
  dialogVisible: false,
  dialogVisible2: false,
  dialogVisible3: false,
  target: "",
  targets: [
    {
      value: "1",
      label: "ç»¼æµ‹é—®é¢˜",
    },
    {
      value: "2",
      label: "å…¶ä»–é—®é¢˜",
    },
  ],
  textarea: "",
  // ç”³è¯‰åˆ—è¡¨
  complaintData: [
    {
      state: 0,
      created: "2023-05-07",
      userNumber: "2022100030",
      type: "ç»¼æµ‹é—®é¢˜",
      content: "ä¸ªäººä¿¡æ¯æ€§åˆ«é”™è¯¯ï¼Œéœ€è¦æ›´æ”¹ä¸ºç”·",
    },
    {
      state: 1,
      created: "2023-05-17",
      userNumber: "2022100030",
      type: "å…¶ä»–é—®é¢˜",
      content: "ä¸ªäººä¿¡æ¯æ€§åˆ«é”™è¯¯ï¼Œéœ€è¦æ›´æ”¹ä¸ºç”·",
    },
    {
      state: 2,
      created: "2023-05-12",
      userNumber: "2022100030",
      type: "å…¶ä»–é—®é¢˜",
      content: "ä¸ªäººä¿¡æ¯æ€§åˆ«é”™è¯¯ï¼Œéœ€è¦æ›´æ”¹ä¸ºç”·",
    },
  ],
});
onMounted(() => {
  init();
});
//åˆå§‹åŒ–
function init() {
  getComplaintHistory();
  studentFun.assess
    .getAssessment({
      month: 1,
    })
    .then((res) => {
      console.log("ä¸ªäººç»¼æµ‹", res);
      // data.assessment=res
    });
}
//è·å–ç”³è¯‰å†å²
function getComplaintHistory() {
  studentFun.complaint
    .getComplaints({
      state: "",
      current: 1,
      size: 1000,
    })
    .then((res) => {
      console.log(res);
      data.complaintData = res.records;
    });
}
//æäº¤ç”³æŠ¥
function commit() {
  studentFun.complaint
    .submitComplaint({
      content: "",
      type: "",
    })
    .then((res) => {
      data.dialogVisible2 = false;
      ElMessage({
        message: "å·²ç”³æŠ¥é”™è¯¯ï¼Œè¯·è€å¿ƒç­‰å¾…å¤„ç†",
        type: "success",
      });
    });
}
//ç­›é€‰å™¨
const filterTag = (value, row) => {
  console.log(row.state,value,row)
  return row.state == value;
};
const { getColumnWidth } = adaptiveColumnWidthFun(data.assessment);
</script>
<style src="@/assets/css/show-container.css" scoped></style>
<style scoped>
el-table el-table-column th {
  font-size: 1.2rem; /* 1.2remç›¸å½“äºæ ¹å…ƒç´ çš„å­—ä½“å¤§å° */
  color: red !important;
}

el-table el-table-column td {
  font-size: 1rem; /* 1remç›¸å½“äºæ ¹å…ƒç´ çš„å­—ä½“å¤§å° */
}
.cell {
  font-size: 4rem !important;
}
</style>
  